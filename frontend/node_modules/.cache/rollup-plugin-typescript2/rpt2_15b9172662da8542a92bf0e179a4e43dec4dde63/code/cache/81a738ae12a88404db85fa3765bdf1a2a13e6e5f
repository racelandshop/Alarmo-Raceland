{"code":"import { __decorate } from \"tslib\";\r\nimport { LitElement, html, css } from 'lit';\r\nimport { property, customElement, state } from 'lit/decorators.js';\r\nimport { fireEvent } from 'custom-card-helpers';\r\nimport { mdiClose } from '@mdi/js';\r\nimport { saveArea, deleteArea, fetchAreas, fetchSensors, fetchAutomations } from '../data/websockets';\r\nimport { commonStyle } from '../styles';\r\nimport { localize } from '../../localize/localize';\r\nimport { SubscribeMixin } from '../subscribe-mixin';\r\nimport { handleError } from '../helpers';\r\nimport './confirm-delete-dialog';\r\nlet CreateAreaDialog = class CreateAreaDialog extends SubscribeMixin(LitElement) {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.areas = {};\r\n        this.sensors = {};\r\n        this.automations = {};\r\n        this.name = '';\r\n    }\r\n    hassSubscribe() {\r\n        this._fetchData();\r\n        return [this.hass.connection.subscribeMessage(() => this._fetchData(), { type: 'alarmo_config_updated' })];\r\n    }\r\n    async _fetchData() {\r\n        if (!this.hass)\r\n            return;\r\n        this.areas = await fetchAreas(this.hass);\r\n        this.sensors = await fetchSensors(this.hass);\r\n        this.automations = await fetchAutomations(this.hass);\r\n    }\r\n    async showDialog(params) {\r\n        await this._fetchData();\r\n        this._params = params;\r\n        if (params.area_id) {\r\n            this.area_id = params.area_id;\r\n            this.name = this.areas[this.area_id].name;\r\n        }\r\n        await this.updateComplete;\r\n    }\r\n    async closeDialog() {\r\n        this._params = undefined;\r\n        this.area_id = undefined;\r\n        this.name = '';\r\n    }\r\n    render() {\r\n        if (!this._params)\r\n            return html ``;\r\n        return html `\r\n      <ha-dialog open .heading=${true} @closed=${this.closeDialog} @close-dialog=${this.closeDialog}>\r\n        <div slot=\"heading\">\r\n          <ha-header-bar>\r\n            <ha-icon-button slot=\"navigationIcon\" dialogAction=\"cancel\" .path=${mdiClose}></ha-icon-button>\r\n            <span slot=\"title\">\r\n              ${this.area_id\r\n            ? localize('panels.general.dialogs.edit_area.title', this.hass.language, '{area}', this.areas[this.area_id].name)\r\n            : localize('panels.general.dialogs.create_area.title', this.hass.language)}\r\n            </span>\r\n          </ha-header-bar>\r\n        </div>\r\n        <div class=\"wrapper\">\r\n          <ha-textfield\r\n            label=${this.hass.localize('ui.components.area-picker.add_dialog.name')}\r\n            @input=${(ev) => (this.name = ev.target.value)}\r\n            value=\"${this.name}\"\r\n          ></ha-textfield>\r\n          ${this.area_id\r\n            ? html `\r\n                <span class=\"note\">\r\n                  ${localize('panels.general.dialogs.edit_area.name_warning', this.hass.language)}\r\n                </span>\r\n              `\r\n            : ''}\r\n          ${!this.area_id\r\n            ? html `\r\n                <alarmo-select\r\n                  .items=${Object.values(this.areas).map(e => Object({ value: e.area_id, name: e.name }))}\r\n                  value=${this.selectedArea}\r\n                  label=\"${localize('panels.general.dialogs.create_area.fields.copy_from', this.hass.language)}\"\r\n                  clearable=${true}\r\n                  @value-changed=${(ev) => (this.selectedArea = ev.target.value)}\r\n                ></alarmo-select>\r\n              `\r\n            : ''}\r\n        </div>\r\n        <mwc-button slot=\"primaryAction\" @click=${this.saveClick}>\r\n          ${this.hass.localize('ui.common.save')}\r\n        </mwc-button>\r\n        ${this.area_id\r\n            ? html `\r\n              <mwc-button\r\n                slot=\"secondaryAction\"\r\n                @click=${this.deleteClick}\r\n                class=\"warning\"\r\n                ?disabled=${Object.keys(this.areas).length == 1}\r\n              >\r\n                ${this.hass.localize('ui.common.delete')}\r\n              </mwc-button>\r\n            `\r\n            : ''}\r\n      </ha-dialog>\r\n    `;\r\n    }\r\n    saveClick(ev) {\r\n        const name = this.name.trim();\r\n        if (!name.length)\r\n            return;\r\n        let data = {\r\n            name: name,\r\n        };\r\n        if (this.area_id)\r\n            data = Object.assign(Object.assign({}, data), { area_id: this.area_id });\r\n        else if (this.selectedArea)\r\n            data = Object.assign(Object.assign({}, data), { modes: Object.assign({}, this.areas[this.selectedArea].modes) });\r\n        saveArea(this.hass, data)\r\n            .catch(e => handleError(e, ev))\r\n            .then(() => {\r\n            this.closeDialog();\r\n        });\r\n    }\r\n    async deleteClick(ev) {\r\n        if (!this.area_id)\r\n            return;\r\n        const sensors = Object.values(this.sensors).filter(e => e.area == this.area_id).length;\r\n        const automations = Object.values(this.automations).filter(e => { var _a; return (_a = e.triggers) === null || _a === void 0 ? void 0 : _a.map(e => e.area).includes(this.area_id); })\r\n            .length;\r\n        let result = false;\r\n        if (sensors || automations) {\r\n            result = await new Promise(resolve => {\r\n                fireEvent(ev.target, 'show-dialog', {\r\n                    dialogTag: 'confirm-delete-dialog',\r\n                    dialogImport: () => import('./confirm-delete-dialog'),\r\n                    dialogParams: {\r\n                        title: localize('panels.general.dialogs.remove_area.title', this.hass.language),\r\n                        description: localize('panels.general.dialogs.remove_area.description', this.hass.language, 'sensors', String(sensors), 'automations', String(automations)),\r\n                        cancel: () => resolve(false),\r\n                        confirm: () => resolve(true),\r\n                    },\r\n                });\r\n            });\r\n        }\r\n        else\r\n            result = true;\r\n        if (result) {\r\n            deleteArea(this.hass, this.area_id)\r\n                .catch(e => handleError(e, ev))\r\n                .then(() => {\r\n                this.closeDialog();\r\n            });\r\n        }\r\n    }\r\n    static get styles() {\r\n        return css `\r\n      ${commonStyle}\r\n      div.wrapper {\r\n        color: var(--primary-text-color);\r\n      }\r\n      span.note {\r\n        color: var(--secondary-text-color);\r\n      }\r\n      ha-textfield {\r\n        display: block;\r\n      }\r\n      alarmo-select {\r\n        margin-top: 10px;\r\n      }\r\n    `;\r\n    }\r\n};\r\n__decorate([\r\n    property({ attribute: false })\r\n], CreateAreaDialog.prototype, \"hass\", void 0);\r\n__decorate([\r\n    state()\r\n], CreateAreaDialog.prototype, \"_params\", void 0);\r\n__decorate([\r\n    property()\r\n], CreateAreaDialog.prototype, \"areas\", void 0);\r\n__decorate([\r\n    property()\r\n], CreateAreaDialog.prototype, \"sensors\", void 0);\r\n__decorate([\r\n    property()\r\n], CreateAreaDialog.prototype, \"automations\", void 0);\r\n__decorate([\r\n    property()\r\n], CreateAreaDialog.prototype, \"name\", void 0);\r\n__decorate([\r\n    property()\r\n], CreateAreaDialog.prototype, \"area_id\", void 0);\r\n__decorate([\r\n    property()\r\n], CreateAreaDialog.prototype, \"selectedArea\", void 0);\r\nCreateAreaDialog = __decorate([\r\n    customElement('create-area-dialog')\r\n], CreateAreaDialog);\r\nexport { CreateAreaDialog };\r\n","references":["/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/lit/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/lit/decorators.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/custom-card-helpers/dist/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/@mdi/js/mdi.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/data/websockets.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/types.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/styles.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/localize/localize.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/home-assistant-js-websocket/dist/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/subscribe-mixin.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/helpers.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/dialogs/confirm-delete-dialog.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/dialogs/confirm-delete-dialog.ts"]}
