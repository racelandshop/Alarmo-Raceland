{"code":"import { __decorate } from \"tslib\";\r\nimport { LitElement, html, css } from 'lit';\r\nimport { property, customElement } from 'lit/decorators.js';\r\nimport { commonStyle } from '../../styles';\r\nimport { localize } from '../../../localize/localize';\r\nimport { EArmModes } from '../../types';\r\nimport { fetchAreas, fetchSensors, saveArea } from '../../data/websockets';\r\nimport { handleError } from '../../helpers';\r\nimport { SubscribeMixin } from '../../subscribe-mixin';\r\nimport { EArmModeIcons } from '../../const';\r\nimport '../../components/time-slider';\r\nimport '../../components/alarmo-select';\r\nimport '../../components/alarmo-collapsible';\r\nimport { exportPath } from '../../common/navigation';\r\nlet AlarmModeCard = class AlarmModeCard extends SubscribeMixin(LitElement) {\r\n    hassSubscribe() {\r\n        this._fetchData();\r\n        return [\r\n            this.hass.connection.subscribeMessage(() => this._fetchData(), {\r\n                type: 'alarmo_config_updated',\r\n            }),\r\n        ];\r\n    }\r\n    async _fetchData() {\r\n        if (!this.hass) {\r\n            return;\r\n        }\r\n        this.areas = await fetchAreas(this.hass);\r\n        this.sensors = await fetchSensors(this.hass);\r\n    }\r\n    async firstUpdated() {\r\n        await this._fetchData();\r\n        this.selectedArea = Object.keys(this.areas)[0];\r\n        this.data = Object.assign({}, this.areas[this.selectedArea].modes);\r\n    }\r\n    render() {\r\n        if (!this.data)\r\n            return html ``;\r\n        return html `\r\n      <ha-card>\r\n        <div class=\"card-header\">\r\n          <div class=\"name\">\r\n            ${localize('panels.general.cards.modes.title', this.hass.language)}\r\n          </div>\r\n\r\n          ${Object.keys(this.areas).length > 1\r\n            ? html `\r\n                <alarmo-select\r\n                  .items=${Object.values(this.areas).map(e => Object({ value: e.area_id, name: e.name }))}\r\n                  value=${this.selectedArea}\r\n                  label=${this.hass.localize('ui.components.area-picker.area')}\r\n                  @value-changed=${(ev) => this.selectArea(ev.target.value)}\r\n                ></alarmo-select>\r\n              `\r\n            : ''}\r\n        </div>\r\n        <div class=\"card-content\">\r\n          ${localize('panels.general.cards.modes.description', this.hass.language)}\r\n        </div>\r\n\r\n        <alarmo-collapsible-group>\r\n          ${Object.entries(EArmModes).map(([k, mode]) => {\r\n            var _a;\r\n            return html `\r\n                <alarmo-collapsible-item>\r\n                  <alarmo-collapsible-header>\r\n                    <ha-icon slot=\"icon\" icon=\"${EArmModeIcons[k]}\"></ha-icon>\r\n                    <span slot=\"title\">\r\n                      ${this.hass.localize(`component.alarm_control_panel.state._.${mode}`)}\r\n                    </span>\r\n                    <span slot=\"description\">\r\n                      ${((_a = this.data[mode]) === null || _a === void 0 ? void 0 : _a.enabled) ? html `\r\n                            ${localize('common.enabled', this.hass.language)},\r\n                            <a href=\"${exportPath('sensors', { filter: { area: this.selectedArea, mode: mode } })}\">\r\n                              ${localize('panels.general.cards.modes.number_sensors_active', this.hass.language, 'number', this.getSensorsByMode(mode))}\r\n                            </a>\r\n                          `\r\n                : localize('common.disabled', this.hass.language)}\r\n                    </span>\r\n                  </alarmo-collapsible-header>\r\n                  <alarmo-collapsible-body>\r\n                    ${this.renderModeConfig(mode)}\r\n                  </alarmo-collapsible-body>\r\n                </alarmo-collapsible-item>\r\n              `;\r\n        })}\r\n        </alarmo-collapsible-group>\r\n      </ha-card>\r\n    `;\r\n    }\r\n    getSensorsByMode(mode) {\r\n        return Object.values(this.sensors).filter(e => e.modes.includes(mode) || e.always_on).length;\r\n    }\r\n    renderModeConfig(mode) {\r\n        const config = mode in this.data ? this.data[mode] : undefined;\r\n        return html `\r\n      <div class=\"description\">\r\n        <ha-icon id=\"warning\" icon=\"mdi:information-outline\"></ha-icon>\r\n        ${localize(`panels.general.cards.modes.modes.${mode}`, this.hass.language)}\r\n      </div>\r\n      <settings-row .narrow=${this.narrow}>\r\n        <span slot=\"heading\">\r\n          ${localize('panels.general.cards.modes.fields.status.heading', this.hass.language)}\r\n        </span>\r\n        <span slot=\"description\">\r\n          ${localize('panels.general.cards.modes.fields.status.description', this.hass.language)}\r\n        </span>\r\n        <div>\r\n          <mwc-button class=\"${(config === null || config === void 0 ? void 0 : config.enabled) ? 'active' : ''}\" @click=${() => this.saveData(mode, { enabled: true })}>\r\n            <ha-icon icon=\"mdi:check\"></ha-icon>\r\n            ${localize('common.enabled', this.hass.language)}\r\n          </mwc-button>\r\n          <mwc-button\r\n            class=\"${(config === null || config === void 0 ? void 0 : config.enabled) ? '' : 'active'}\"\r\n            @click=${() => this.saveData(mode, { enabled: false })}\r\n          >\r\n            <ha-icon icon=\"mdi:close\"></ha-icon>\r\n            ${localize('common.disabled', this.hass.language)}\r\n          </mwc-button>\r\n        </div>\r\n      </settings-row>\r\n      <settings-row .narrow=${this.narrow}>\r\n        <span slot=\"heading\">\r\n          ${localize('panels.general.cards.modes.fields.exit_delay.heading', this.hass.language)}\r\n        </span>\r\n        <span slot=\"description\">\r\n          ${localize('panels.general.cards.modes.fields.exit_delay.description', this.hass.language)}\r\n        </span>\r\n        <time-slider\r\n          .hass=${this.hass}\r\n          unit=\"sec\"\r\n          max=\"180\"\r\n          zeroValue=${localize('components.time_slider.none', this.hass.language)}\r\n          value=${(config === null || config === void 0 ? void 0 : config.exit_time) || 0}\r\n          @change=${(ev) => this.saveData(mode, {\r\n            exit_time: Number(ev.target.value),\r\n        })}\r\n          ?disabled=${!(config === null || config === void 0 ? void 0 : config.enabled)}\r\n        ></time-slider>\r\n      </settings-row>\r\n      <settings-row .narrow=${this.narrow}>\r\n        <span slot=\"heading\">\r\n          ${localize('panels.general.cards.modes.fields.entry_delay.heading', this.hass.language)}\r\n        </span>\r\n        <span slot=\"description\">\r\n          ${localize('panels.general.cards.modes.fields.entry_delay.description', this.hass.language)}\r\n        </span>\r\n        <time-slider\r\n          .hass=${this.hass}\r\n          unit=\"sec\"\r\n          max=\"180\"\r\n          zeroValue=${localize('components.time_slider.none', this.hass.language)}\r\n          value=${(config === null || config === void 0 ? void 0 : config.entry_time) || 0}\r\n          @change=${(ev) => this.saveData(mode, {\r\n            entry_time: Number(ev.target.value),\r\n        })}\r\n          ?disabled=${!(config === null || config === void 0 ? void 0 : config.enabled)}\r\n        ></time-slider>\r\n      </settings-row>\r\n      <settings-row .narrow=${this.narrow}>\r\n        <span slot=\"heading\">\r\n          ${localize('panels.general.cards.modes.fields.trigger_time.heading', this.hass.language)}\r\n        </span>\r\n        <span slot=\"description\">\r\n          ${localize('panels.general.cards.modes.fields.trigger_time.description', this.hass.language)}\r\n        </span>\r\n        <time-slider\r\n          .hass=${this.hass}\r\n          unit=\"min\"\r\n          max=\"3600\"\r\n          zeroValue=${localize('components.time_slider.infinite', this.hass.language)}\r\n          value=${(config === null || config === void 0 ? void 0 : config.trigger_time) || 0}\r\n          @change=${(ev) => this.saveData(mode, {\r\n            trigger_time: Number(ev.target.value),\r\n        })}\r\n          ?disabled=${!(config === null || config === void 0 ? void 0 : config.enabled)}\r\n        ></time-slider>\r\n      </settings-row>\r\n    `;\r\n    }\r\n    selectArea(area_id) {\r\n        if (area_id == this.selectedArea)\r\n            return;\r\n        this.selectedArea = area_id;\r\n        this.data = Object.assign({}, this.areas[area_id].modes);\r\n    }\r\n    saveClick(ev) {\r\n        saveArea(this.hass, { area_id: this.selectedArea, modes: this.data })\r\n            .catch(e => handleError(e, ev))\r\n            .then();\r\n    }\r\n    saveData(mode, update) {\r\n        const DefaultMode = {\r\n            enabled: false,\r\n            exit_time: 0,\r\n            entry_time: 0,\r\n            trigger_time: 0,\r\n        };\r\n        this.data = Object.assign(Object.assign({}, this.data), { [mode]: Object.assign(Object.assign({}, (this.data[mode] || DefaultMode)), update) });\r\n        saveArea(this.hass, { area_id: this.selectedArea, modes: this.data })\r\n            .catch(e => handleError(e, this.shadowRoot.querySelector('ha-card')))\r\n            .then();\r\n    }\r\n    static get styles() {\r\n        return css `\r\n      ${commonStyle}\r\n      alarmo-collapsible-header:first-of-type {\r\n        border-top: 1px solid var(--divider-color);\r\n      }\r\n      .description {\r\n        margin: 8px;\r\n        padding: 12px;\r\n        color: var(--primary-text-color);\r\n        filter: brightness(0.85);\r\n        font-size: 14px;\r\n        line-height: 1.5em;\r\n        min-height: 36px;\r\n        display: flex;\r\n        align-items: center;\r\n        position: relative;\r\n      }\r\n      .description::before {\r\n        position: absolute;\r\n        top: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        left: 0;\r\n        pointer-events: none;\r\n        content: '';\r\n        background: rgba(var(--rgb-primary-color), 0.12);\r\n        border-radius: 5px;\r\n      }\r\n      .description ha-icon {\r\n        --mdc-icon-size: 36px;\r\n        display: inline;\r\n        float: left;\r\n        margin-right: 12px;\r\n        align-self: flex-start;\r\n      }\r\n    `;\r\n    }\r\n};\r\n__decorate([\r\n    property()\r\n], AlarmModeCard.prototype, \"hass\", void 0);\r\n__decorate([\r\n    property({ type: Boolean })\r\n], AlarmModeCard.prototype, \"narrow\", void 0);\r\n__decorate([\r\n    property()\r\n], AlarmModeCard.prototype, \"config\", void 0);\r\n__decorate([\r\n    property()\r\n], AlarmModeCard.prototype, \"areas\", void 0);\r\n__decorate([\r\n    property()\r\n], AlarmModeCard.prototype, \"sensors\", void 0);\r\n__decorate([\r\n    property()\r\n], AlarmModeCard.prototype, \"data\", void 0);\r\n__decorate([\r\n    property()\r\n], AlarmModeCard.prototype, \"selectedArea\", void 0);\r\nAlarmModeCard = __decorate([\r\n    customElement('alarm-mode-card')\r\n], AlarmModeCard);\r\nexport { AlarmModeCard };\r\n","references":["/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/lit/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/lit/decorators.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/custom-card-helpers/dist/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/home-assistant-js-websocket/dist/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/styles.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/localize/localize.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/types.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/data/websockets.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/helpers.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/subscribe-mixin.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/const.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/components/time-slider.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/components/alarmo-select.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/components/alarmo-collapsible.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/common/navigation.ts"]}
