{"code":"import { __decorate } from \"tslib\";\r\nimport { html, LitElement } from 'lit';\r\nimport { customElement, property } from 'lit/decorators';\r\nimport { localize } from '../../../localize/localize';\r\nimport { defaultSensorConfig, getConfigurableSensors, sensorClassToType } from '../../data/sensors';\r\nimport { fetchAreas, fetchSensors, saveSensor } from '../../data/websockets';\r\nimport { handleError, prettyPrint } from '../../helpers';\r\nimport { commonStyle } from '../../styles';\r\nimport { SubscribeMixin } from '../../subscribe-mixin';\r\nimport '../../components/alarmo-table.ts';\r\nlet AddSensorsCard = class AddSensorsCard extends SubscribeMixin(LitElement) {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.addSelection = [];\r\n        this.areas = {};\r\n        this.sensors = {};\r\n    }\r\n    hassSubscribe() {\r\n        this._fetchData();\r\n        return [this.hass.connection.subscribeMessage(() => this._fetchData(), { type: 'alarmo_config_updated' })];\r\n    }\r\n    async _fetchData() {\r\n        if (!this.hass) {\r\n            return;\r\n        }\r\n        this.areas = await fetchAreas(this.hass);\r\n    }\r\n    async firstUpdated() {\r\n        this.areas = await fetchAreas(this.hass);\r\n        this.sensors = await fetchSensors(this.hass);\r\n    }\r\n    render() {\r\n        const columns = {\r\n            checkbox: {\r\n                width: '48px',\r\n                renderer: (item) => html `\r\n          <ha-checkbox\r\n            @change=${(e) => this.toggleSelect(e, item.id)}\r\n            ?checked=${this.addSelection.includes(item.id)}\r\n          ></ha-checkbox>\r\n        `,\r\n            },\r\n            icon: {\r\n                width: '40px',\r\n                renderer: (item) => html `\r\n          <state-badge .hass=${this.hass} .stateObj=${this.hass.states[item.id]}></state-badge>\r\n        `,\r\n            },\r\n            name: {\r\n                title: this.hass.localize('ui.components.entity.entity-picker.entity'),\r\n                width: '40%',\r\n                grow: true,\r\n                text: true,\r\n                renderer: (item) => html `\r\n          ${prettyPrint(item.name)}\r\n          <span class=\"secondary\">${item.id}</span>\r\n        `,\r\n            },\r\n            type: {\r\n                title: localize('panels.sensors.cards.add_sensors.table.type', this.hass.language),\r\n                width: '40%',\r\n                hide: this.narrow,\r\n                text: true,\r\n                renderer: (item) => item.type\r\n                    ? localize(`panels.sensors.cards.editor.fields.device_type.choose.${item.type}.name`, this.hass.language)\r\n                    : this.hass.localize('state.default.unknown'),\r\n            },\r\n        };\r\n        const sensorList = getConfigurableSensors(this.hass, Object.keys(this.sensors), true);\r\n        const tableData = sensorList.map(item => {\r\n            const output = Object.assign(Object.assign({}, item), { type: sensorClassToType(this.hass.states[item.id]), isSupportedType: sensorClassToType(this.hass.states[item.id]) !== undefined ? 'true' : 'false' });\r\n            return output;\r\n        });\r\n        return html `\r\n      <ha-card header=\"${localize('panels.sensors.cards.add_sensors.title', this.hass.language)}\">\r\n        <div class=\"card-content\">\r\n          ${localize('panels.sensors.cards.add_sensors.description', this.hass.language)}\r\n        </div>\r\n\r\n        <alarmo-table\r\n          .hass=${this.hass}\r\n          .columns=${columns}\r\n          .data=${tableData}\r\n          .filters=${this.getTableFilterOptions()}\r\n        >\r\n          ${localize('panels.sensors.cards.add_sensors.no_items', this.hass.language)}\r\n        </alarmo-table>\r\n\r\n        <div class=\"card-actions\">\r\n          <mwc-button @click=${this.addSelected} ?disabled=${this.addSelection.length == 0}>\r\n            ${localize('panels.sensors.cards.add_sensors.actions.add_to_alarm', this.hass.language)}\r\n          </mwc-button>\r\n        </div>\r\n      </ha-card>\r\n    `;\r\n    }\r\n    toggleSelect(ev, id) {\r\n        const checked = ev.target.checked;\r\n        this.addSelection =\r\n            checked && !this.addSelection.includes(id)\r\n                ? [...this.addSelection, id]\r\n                : !checked\r\n                    ? this.addSelection.filter(e => e != id)\r\n                    : this.addSelection;\r\n    }\r\n    addSelected(ev) {\r\n        if (!this.hass)\r\n            return;\r\n        const modeList = Object.values(this.areas)\r\n            .map(e => Object.entries(e.modes)\r\n            .filter(([, v]) => v.enabled)\r\n            .map(([k]) => k))\r\n            .reduce((a, b) => a.filter(i => b.includes(i)));\r\n        const data = this.addSelection\r\n            .map(e => defaultSensorConfig(this.hass.states[e], modeList))\r\n            .map(e => Object.keys(this.areas).length == 1\r\n            ? Object.assign(e, {\r\n                area: Object.keys(this.areas)[0],\r\n            })\r\n            : e)\r\n            .filter(e => e);\r\n        data.forEach(el => {\r\n            saveSensor(this.hass, el)\r\n                .catch(e => handleError(e, ev))\r\n                .then();\r\n        });\r\n        this.addSelection = [];\r\n    }\r\n    getTableFilterOptions() {\r\n        const filterConfig = {\r\n            isSupportedType: {\r\n                name: localize('panels.sensors.cards.add_sensors.actions.filter_supported', this.hass.language),\r\n                items: [{\r\n                        value: 'true',\r\n                        name: 'true'\r\n                    }],\r\n                value: ['true'],\r\n                binary: true\r\n            },\r\n        };\r\n        return filterConfig;\r\n    }\r\n};\r\nAddSensorsCard.styles = commonStyle;\r\n__decorate([\r\n    property()\r\n], AddSensorsCard.prototype, \"hass\", void 0);\r\n__decorate([\r\n    property()\r\n], AddSensorsCard.prototype, \"narrow\", void 0);\r\n__decorate([\r\n    property()\r\n], AddSensorsCard.prototype, \"addSelection\", void 0);\r\n__decorate([\r\n    property()\r\n], AddSensorsCard.prototype, \"areas\", void 0);\r\n__decorate([\r\n    property()\r\n], AddSensorsCard.prototype, \"sensors\", void 0);\r\nAddSensorsCard = __decorate([\r\n    customElement('add-sensors-card')\r\n], AddSensorsCard);\r\nexport { AddSensorsCard };\r\n","references":["/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/custom-card-helpers/dist/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/home-assistant-js-websocket/dist/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/lit/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/lit/decorators.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/localize/localize.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/components/alarmo-table.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/data/sensors.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/data/websockets.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/helpers.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/styles.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/subscribe-mixin.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/types.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/const.ts"]}
