{"code":"import { __decorate } from \"tslib\";\r\nimport { LitElement, html, css } from 'lit';\r\nimport { property, customElement, state } from 'lit/decorators.js';\r\nimport { mdiClose } from '@mdi/js';\r\nimport { fetchSensors, fetchSensorGroups, saveSensorGroup, deleteSensorGroup } from '../data/websockets';\r\nimport { dialogStyle } from '../styles';\r\nimport { localize } from '../../localize/localize';\r\nimport { SubscribeMixin } from '../subscribe-mixin';\r\nimport { computeName, handleError, isDefined, prettyPrint, showErrorDialog, sortAlphabetically } from '../helpers';\r\nimport { ESensorIcons, ESensorTypes } from '../const';\r\nimport '../components/alarmo-chip-set';\r\nlet CreateSensorGroupDialog = class CreateSensorGroupDialog extends SubscribeMixin(LitElement) {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.sensorGroups = {};\r\n        this.sensors = {};\r\n    }\r\n    hassSubscribe() {\r\n        this._fetchData();\r\n        return [this.hass.connection.subscribeMessage(() => this._fetchData(), { type: 'alarmo_config_updated' })];\r\n    }\r\n    async _fetchData() {\r\n        if (!this.hass)\r\n            return;\r\n        this.sensorGroups = await fetchSensorGroups(this.hass);\r\n        this.sensors = await fetchSensors(this.hass);\r\n    }\r\n    async showDialog(params) {\r\n        await this._fetchData();\r\n        this._params = params;\r\n        if (params.group_id && Object.keys(this.sensorGroups).includes(params.group_id)) {\r\n            this.data = Object.assign({}, this.sensorGroups[params.group_id]);\r\n        }\r\n        else {\r\n            this.data = {\r\n                name: '',\r\n                entities: [],\r\n                timeout: 600,\r\n            };\r\n        }\r\n        await this.updateComplete;\r\n    }\r\n    async closeDialog() {\r\n        this._params = undefined;\r\n    }\r\n    render() {\r\n        if (!this._params)\r\n            return html ``;\r\n        return html `\r\n      <ha-dialog open @closed=${this.closeDialog} @close-dialog=${this.closeDialog} .heading=${this.renderHeader()}>\r\n        <div class=\"wrapper\">\r\n          <settings-row dialog>\r\n            <span slot=\"heading\">\r\n              ${localize('panels.sensors.dialogs.create_group.fields.name.heading', this.hass.language)}\r\n            </span>\r\n            <span slot=\"description\">\r\n              ${localize('panels.sensors.dialogs.create_group.fields.name.description', this.hass.language)}\r\n            </span>\r\n            <ha-textfield\r\n              label=${this.hass.localize('ui.components.area-picker.add_dialog.name')}\r\n              @input=${(ev) => (this.data = { ...this.data, name: String(ev.target.value).trim() })}\r\n              value=\"${this.data.name}\"\r\n            ></ha-textfield>\r\n          </settings-row>\r\n\r\n          <settings-row large dialog>\r\n            <span slot=\"heading\">\r\n              ${localize('panels.sensors.dialogs.create_group.fields.sensors.heading', this.hass.language)}\r\n            </span>\r\n            <span slot=\"description\">\r\n              ${localize('panels.sensors.dialogs.create_group.fields.sensors.description', this.hass.language)}\r\n            </span>\r\n            <div>\r\n              ${this.renderSensorOptions()}\r\n            </div>\r\n          </settings-row>\r\n\r\n          <settings-row dialog>\r\n            <span slot=\"heading\">\r\n              ${localize('panels.sensors.dialogs.create_group.fields.timeout.heading', this.hass.language)}\r\n            </span>\r\n            <span slot=\"description\">\r\n              ${localize('panels.sensors.dialogs.create_group.fields.timeout.description', this.hass.language)}\r\n            </span>\r\n            <time-slider\r\n              .hass=${this.hass}\r\n              unit=\"min\"\r\n              max=\"1200\"\r\n              .value=${this.data.timeout}\r\n              @change=${(ev) => (this.data = { ...this.data, timeout: Number(ev.target.value) })}\r\n            ></time-slider>\r\n          </settings-row>\r\n        </div>\r\n        <mwc-button slot=\"secondaryAction\" @click=${this.saveClick}>\r\n          ${this.hass.localize('ui.common.save')}\r\n        </mwc-button>\r\n        ${this.data.group_id\r\n            ? html `\r\n              <mwc-button slot=\"secondaryAction\" @click=${this.deleteClick} class=\"warning\">\r\n                ${this.hass.localize('ui.common.delete')}\r\n              </mwc-button>\r\n            `\r\n            : ''}\r\n      </ha-dialog>\r\n    `;\r\n    }\r\n    renderHeader() {\r\n        return html `\r\n      <span class=\"header_title\">\r\n        ${this.data.group_id\r\n            ? localize('panels.sensors.dialogs.edit_group.title', this.hass.language, '{name}', this.sensorGroups[this.data.group_id].name)\r\n            : localize('panels.sensors.dialogs.create_group.title', this.hass.language)}\r\n      </span>\r\n      <ha-icon-button\r\n        .label=${this.hass.localize('ui.dialogs.generic.close')}\r\n        .path=${mdiClose}\r\n        dialogAction=\"close\"\r\n        class=\"header_button\"\r\n      ></ha-icon-button>\r\n    `;\r\n    }\r\n    renderSensorOptions() {\r\n        const sensors = Object.keys(this.sensors)\r\n            .filter(e => !isDefined(this.sensors[e].group) || this.sensors[e].group === this.data.group_id)\r\n            .map(e => {\r\n            const stateObj = this.hass.states[e];\r\n            const type = Object.entries(ESensorTypes).find(([, v]) => v == this.sensors[e].type)[0];\r\n            return {\r\n                value: e,\r\n                name: prettyPrint(computeName(stateObj)),\r\n                icon: ESensorIcons[type],\r\n            };\r\n        });\r\n        sensors.sort(sortAlphabetically);\r\n        if (!sensors.length)\r\n            return localize('panels.sensors.cards.sensors.no_items', this.hass.language);\r\n        return html `\r\n      <alarmo-chip-set\r\n        .items=${sensors}\r\n        .value=${this.data.entities}\r\n        ?selectable=${true}\r\n        @value-changed=${(ev) => (this.data = { ...this.data, entities: ev.detail })}\r\n      ></alarmo-chip-set>\r\n    `;\r\n    }\r\n    saveClick(ev) {\r\n        if (!this.data.name.length)\r\n            showErrorDialog(ev, localize('panels.sensors.dialogs.create_group.errors.invalid_name', this.hass.language));\r\n        else if ((!this.data.group_id || this.data.name != this.sensorGroups[this.data.group_id].name) &&\r\n            Object.values(this.sensorGroups).find(e => e.name.toLowerCase() == this.data.name.toLowerCase()))\r\n            showErrorDialog(ev, localize('panels.sensors.dialogs.create_group.errors.invalid_name', this.hass.language));\r\n        else if (this.data.entities.length < 2)\r\n            showErrorDialog(ev, localize('panels.sensors.dialogs.create_group.errors.insufficient_sensors', this.hass.language));\r\n        else {\r\n            saveSensorGroup(this.hass, this.data)\r\n                .catch(e => handleError(e, ev))\r\n                .then(() => {\r\n                this.closeDialog();\r\n            });\r\n        }\r\n    }\r\n    deleteClick(ev) {\r\n        if (!this.data.group_id)\r\n            return;\r\n        deleteSensorGroup(this.hass, this.data.group_id)\r\n            .catch(e => handleError(e, ev))\r\n            .then(() => {\r\n            this.closeDialog();\r\n        });\r\n    }\r\n    static get styles() {\r\n        return css `\r\n      ${dialogStyle}\r\n      div.wrapper {\r\n        color: var(--primary-text-color);\r\n      }\r\n      mwc-button.warning {\r\n        --mdc-theme-primary: var(--error-color);\r\n      }\r\n    `;\r\n    }\r\n};\r\n__decorate([\r\n    property({ attribute: false })\r\n], CreateSensorGroupDialog.prototype, \"hass\", void 0);\r\n__decorate([\r\n    state()\r\n], CreateSensorGroupDialog.prototype, \"_params\", void 0);\r\n__decorate([\r\n    property()\r\n], CreateSensorGroupDialog.prototype, \"sensorGroups\", void 0);\r\n__decorate([\r\n    property()\r\n], CreateSensorGroupDialog.prototype, \"sensors\", void 0);\r\n__decorate([\r\n    property()\r\n], CreateSensorGroupDialog.prototype, \"data\", void 0);\r\nCreateSensorGroupDialog = __decorate([\r\n    customElement('create-sensor-group-dialog')\r\n], CreateSensorGroupDialog);\r\nexport { CreateSensorGroupDialog };\r\n","references":["/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/lit/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/lit/decorators.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/custom-card-helpers/dist/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/@mdi/js/mdi.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/data/websockets.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/types.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/styles.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/localize/localize.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/home-assistant-js-websocket/dist/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/subscribe-mixin.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/helpers.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/const.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/components/alarmo-chip-set.ts"]}
