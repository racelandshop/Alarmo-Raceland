{"code":"import { __decorate } from \"tslib\";\r\nimport { mdiFilterVariant, mdiClose } from '@mdi/js';\r\nimport { LitElement, html, css } from 'lit';\r\nimport { property, customElement, state, query } from 'lit/decorators.js';\r\nimport { localize } from '../../localize/localize';\r\nimport './alarmo-chip-set';\r\nimport { omit, pick } from '../helpers';\r\nlet AlarmoTable = class AlarmoTable extends LitElement {\r\n    set filters(data) {\r\n        if (this.filterConfig)\r\n            return;\r\n        this.filterConfig = data;\r\n    }\r\n    shouldUpdate(changedProps) {\r\n        if (changedProps.get('filters') && !this.filterConfig) {\r\n            this.filterConfig = changedProps.get('filters');\r\n        }\r\n        return true;\r\n    }\r\n    render() {\r\n        if (!this.columns || !this.data)\r\n            return html ``;\r\n        const filteredData = this.data.filter(e => this.filterTableData(e, this.filterConfig));\r\n        return html `\r\n      ${this.renderFilterRow()}\r\n      <div class=\"table\">\r\n        ${this.renderHeaderRow()}\r\n        ${filteredData.length\r\n            ? filteredData.map(e => this.renderDataRow(e))\r\n            : html `\r\n              <div class=\"table-row\">\r\n                <div class=\"table-cell text grow\">\r\n                  <slot></slot>\r\n                </div>\r\n              </div>\r\n            `}\r\n      </div>\r\n    `;\r\n    }\r\n    renderHeaderRow() {\r\n        if (!this.columns)\r\n            return html ``;\r\n        return html `\r\n      <div class=\"table-row header\">\r\n        ${Object.values(this.columns).map(e => e.hide\r\n            ? ''\r\n            : html `\r\n                <div\r\n                  class=\"table-cell ${e.text ? 'text' : ''} ${e.grow ? 'grow' : ''} ${e.align ? e.align : ''}\"\r\n                  style=\"${e.grow ? '' : `width: ${e.width}`}\"\r\n                >\r\n                  <span>${e.title || ''}</span>\r\n                </div>\r\n              `)}\r\n      </div>\r\n    `;\r\n    }\r\n    renderDataRow(data) {\r\n        if (!this.columns)\r\n            return html ``;\r\n        return html `\r\n      <div\r\n        class=\"table-row ${this.selectable ? 'selectable' : ''} ${data.warning ? 'warning' : ''}\"\r\n        @click=${() => this.handleClick(String(data.id))}\r\n      >\r\n        ${Object.entries(this.columns).map(([col, e]) => e.hide\r\n            ? ''\r\n            : html `\r\n                <div\r\n                  class=\"table-cell ${e.text ? 'text' : ''} ${e.grow ? 'grow' : ''} ${e.align ? e.align : ''}\"\r\n                  style=\"${e.grow ? '' : `width: ${e.width}`}\"\r\n                >\r\n                  ${e.renderer ? e.renderer(data) : data[col]}\r\n                </div>\r\n              `)}\r\n      </div>\r\n    `;\r\n    }\r\n    filterTableData(data, filterConfig) {\r\n        if (!filterConfig)\r\n            return true;\r\n        return Object.keys(filterConfig).every(key => {\r\n            if (!Object.keys(data).includes(key))\r\n                return true;\r\n            const filterValue = filterConfig[key].value;\r\n            if (!filterValue || !filterValue.length)\r\n                return true;\r\n            if (Array.isArray(data[key]))\r\n                return data[key].some(e => filterValue.includes(e));\r\n            return filterValue.includes(data[key]);\r\n        });\r\n    }\r\n    _getFilteredItems() {\r\n        return this.data.filter(e => !this.filterTableData(e, this.filterConfig)).length;\r\n    }\r\n    handleClick(id) {\r\n        if (!this.selectable)\r\n            return;\r\n        const myEvent = new CustomEvent('row-click', { detail: { id: id } });\r\n        this.dispatchEvent(myEvent);\r\n    }\r\n    renderFilterRow() {\r\n        var _a;\r\n        if (!this.filterConfig)\r\n            return html ``;\r\n        return html `\r\n      <div class=\"table-filter\">\r\n        <ha-icon-button\r\n          .path=${mdiFilterVariant}\r\n          ?disabled=${!((_a = this.data) === null || _a === void 0 ? void 0 : _a.length)}\r\n          label=${localize('components.table.filter.label', this.hass.language)}\r\n          @click=${this._toggleFilterMenu}\r\n        ></ha-icon-button>\r\n        <mwc-menu .corner=${'BOTTOM_START'} .fixed=${true} @closed=${this._applyFilterSelection}>\r\n          ${this.renderFilterMenu()}\r\n        </mwc-menu>\r\n\r\n        ${this._getFilteredItems()\r\n            ? html `\r\n              <alarmo-chip cancellable table @button-clicked=${this._clearFilters}>\r\n                ${localize('components.table.filter.hidden_items', this.hass.language, 'number', this._getFilteredItems())}\r\n              </alarmo-chip>\r\n            `\r\n            : ''}\r\n      </div>\r\n    `;\r\n    }\r\n    _toggleFilterMenu(ev) {\r\n        const el = ev.target;\r\n        this._menu.anchor = el;\r\n        if (this._menu.open)\r\n            this._menu.close();\r\n        else {\r\n            this.filterSelection = Object.entries(this.filterConfig).reduce((acc, [k, v]) => (Object.assign(Object.assign({}, acc), { [k]: pick(v, ['value']) })), {});\r\n            this._menu.show();\r\n        }\r\n    }\r\n    renderFilterMenu() {\r\n        if (!this.filterConfig || !this.filterSelection)\r\n            return html ``;\r\n        return html `\r\n      <span class=\"header\">\r\n        ${localize('components.table.filter.label', this.hass.language)}\r\n      </span>\r\n      <ha-icon-button\r\n        .path=${mdiClose}\r\n        @click=${() => {\r\n            this._menu.close();\r\n            setTimeout(() => this._menu.anchor.blur(), 50);\r\n        }}\r\n      ></ha-icon-button>\r\n      ${Object.keys(this.filterConfig).map(key => {\r\n            if (this.filterConfig[key].binary) {\r\n                return html `\r\n            <div class=\"dropdown-item checkbox\">\r\n              <ha-checkbox\r\n                @change=${(ev) => this._updateFilterSelection(key, ev.target.checked)}\r\n                ?checked=${this.filterSelection[key].value.length}\r\n              ></ha-checkbox>\r\n              <span class=\"name\">\r\n                ${this.filterConfig[key].name}\r\n              </span>\r\n            </div>\r\n          `;\r\n            }\r\n            let items = this.filterConfig[key].items;\r\n            items = items.map(e => {\r\n                var _a;\r\n                if (e.badge && typeof e.badge == 'function')\r\n                    return {\r\n                        ...e,\r\n                        badge: e.badge((_a = this.data) === null || _a === void 0 ? void 0 : _a.filter(a => this.filterTableData(a, omit(this.filterSelection, key)))),\r\n                    };\r\n                else\r\n                    return e;\r\n            });\r\n            const value = this.filterSelection[key].value;\r\n            return html `\r\n          <div class=\"dropdown-item\">\r\n            <span class=\"name\">\r\n              ${this.filterConfig[key].name}\r\n            </span>\r\n            <alarmo-chip-set\r\n              selectable\r\n              .items=${items}\r\n              @value-changed=${(ev) => this._updateFilterSelection(key, ev.detail)}\r\n              .value=${value}\r\n            ></alarmo-chip-set>\r\n          </div>\r\n        `;\r\n        })}\r\n    `;\r\n    }\r\n    _updateFilterSelection(key, value) {\r\n        if (typeof value == 'boolean') {\r\n            value = (value ? this.filterConfig[key].items[0].value : []);\r\n            if (Object.keys(this.filterConfig).length == 1) {\r\n                this._menu.close();\r\n                setTimeout(() => this._menu.anchor.blur(), 50);\r\n            }\r\n        }\r\n        this.filterSelection = Object.assign(Object.assign({}, this.filterSelection), { [key]: { value: value } });\r\n    }\r\n    _clearFilters() {\r\n        Object.keys(this.filterConfig).forEach(key => {\r\n            this.filterConfig = Object.assign(Object.assign({}, this.filterConfig), { [key]: Object.assign(Object.assign({}, this.filterConfig[key]), { value: [] }) });\r\n        });\r\n    }\r\n    _applyFilterSelection() {\r\n        Object.keys(this.filterConfig).forEach(key => {\r\n            this.filterConfig = Object.assign(Object.assign({}, this.filterConfig), { [key]: Object.assign(Object.assign({}, this.filterConfig[key]), this.filterSelection[key]) });\r\n        });\r\n    }\r\n};\r\nAlarmoTable.styles = css `\r\n    :host {\r\n      width: 100%;\r\n    }\r\n    div.table {\r\n      display: inline-flex;\r\n      flex-direction: column;\r\n      box-sizing: border-box;\r\n      width: 100%;\r\n    }\r\n    div.table .header {\r\n      font-weight: bold;\r\n    }\r\n    div.table-row {\r\n      display: flex;\r\n      width: 100%;\r\n      height: 52px;\r\n      border-top: 1px solid var(--divider-color);\r\n      flex-direction: row;\r\n      position: relative;\r\n    }\r\n    div.table-cell {\r\n      align-self: center;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      flex-shrink: 0;\r\n      box-sizing: border-box;\r\n    }\r\n    div.table-cell.text {\r\n      padding: 4px 16px;\r\n    }\r\n    div.table-cell.grow {\r\n      flex-grow: 1;\r\n      flex-shrink: 1;\r\n    }\r\n\r\n    div.table-cell > ha-switch {\r\n      width: 68px;\r\n      height: 48px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n    }\r\n\r\n    div.table-cell.center {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n    }\r\n\r\n    div.table-cell.right {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: flex-end;\r\n    }\r\n\r\n    div.table-cell > ha-icon-button {\r\n      color: var(--secondary-text-color);\r\n    }\r\n    div.table-cell > * {\r\n      transition: color 0.2s ease-in-out;\r\n    }\r\n    div.table .header div.table-cell span {\r\n      white-space: nowrap;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      min-width: 0;\r\n    }\r\n    div.table-row.selectable {\r\n      cursor: pointer;\r\n    }\r\n    .table-row::before {\r\n      position: absolute;\r\n      top: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      left: 0;\r\n      opacity: 0.12;\r\n      pointer-events: none;\r\n      content: '';\r\n      border-radius: 4px;\r\n    }\r\n    div.table-row.selectable:hover::before {\r\n      background-color: rgba(var(--rgb-primary-text-color), 0.5);\r\n    }\r\n    div.table-row.warning::before {\r\n      background-color: var(--error-color);\r\n      opacity: 0.06;\r\n    }\r\n    div.table-row.warning:hover::before {\r\n      background-color: var(--error-color);\r\n      opacity: 0.12;\r\n    }\r\n    div.table-row.warning span {\r\n      color: var(--error-color);\r\n    }\r\n\r\n    ha-icon {\r\n      color: var(--state-icon-color);\r\n      padding: 8px;\r\n    }\r\n\r\n    .secondary {\r\n      color: var(--secondary-text-color);\r\n      display: flex;\r\n      padding-top: 4px;\r\n    }\r\n\r\n    a,\r\n    a:visited {\r\n      color: var(--primary-color);\r\n    }\r\n\r\n    span.disabled {\r\n      color: var(--secondary-text-color);\r\n    }\r\n    span.secondary.disabled {\r\n      color: var(--disabled-text-color);\r\n    }\r\n    ha-icon.disabled {\r\n      color: var(--state-unavailable-color);\r\n    }\r\n\r\n    div.table-filter {\r\n      display: flex;\r\n      width: 100%;\r\n      min-height: 52px;\r\n      border-top: 1px solid var(--divider-color);\r\n      box-sizing: border-box;\r\n      padding: 2px 8px;\r\n      flex: 1;\r\n      position: relative;\r\n      flex-direction: row;\r\n      align-items: center;\r\n    }\r\n    mwc-menu .header {\r\n      display: flex;\r\n      padding: 8px 16px;\r\n      font-weight: bold;\r\n    }\r\n    mwc-menu ha-icon-button {\r\n      position: absolute;\r\n      top: 8px;\r\n      right: 8px;\r\n    }\r\n    div.dropdown-item {\r\n      display: flex;\r\n      flex-direction: column;\r\n      flex-shrink: 0;\r\n      padding: 8px 16px;\r\n      width: 100%;\r\n      min-height: 52px;\r\n      box-sizing: border-box;\r\n    }\r\n    div.dropdown-item .name {\r\n      display: inline-flex;\r\n    }\r\n    div.dropdown-item alarmo-chips {\r\n      display: flex;\r\n      flex-direction: row;\r\n    }\r\n    div.dropdown-item.checkbox {\r\n      flex-direction: row;\r\n      align-items: center;\r\n    }\r\n    ha-button-menu mwc-button {\r\n      margin-left: 16px;\r\n    }\r\n  `;\r\n__decorate([\r\n    property()\r\n], AlarmoTable.prototype, \"hass\", void 0);\r\n__decorate([\r\n    property()\r\n], AlarmoTable.prototype, \"columns\", void 0);\r\n__decorate([\r\n    property()\r\n], AlarmoTable.prototype, \"data\", void 0);\r\n__decorate([\r\n    state()\r\n], AlarmoTable.prototype, \"filterConfig\", void 0);\r\n__decorate([\r\n    state()\r\n], AlarmoTable.prototype, \"filterSelection\", void 0);\r\n__decorate([\r\n    property({ type: Boolean })\r\n], AlarmoTable.prototype, \"selectable\", void 0);\r\n__decorate([\r\n    query('mwc-menu', true)\r\n], AlarmoTable.prototype, \"_menu\", void 0);\r\nAlarmoTable = __decorate([\r\n    customElement('alarmo-table')\r\n], AlarmoTable);\r\nexport { AlarmoTable };\r\n","references":["/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/@mdi/js/mdi.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/custom-card-helpers/dist/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/lit/index.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/node_modules/lit/decorators.d.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/types.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/localize/localize.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/components/alarmo-chip-set.ts","/workspaces/RacelandHA/config/custom_components/alarmo/frontend/src/helpers.ts"]}
